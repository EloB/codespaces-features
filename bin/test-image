#!/bin/sh
set -e

if (echo "$2" | grep -Eq arm64$); then
  echo "arm64"
  docker run \
    --platform linux/arm64 \
    --volume "${PWD}:/var/task" \
    --workdir="/var/task" \
    --rm \
    --init \
    --privileged \
    --entrypoint "test/${1}" \
    "${2}"
else
  echo "x86_64"
  docker run \
    --volume "${PWD}:/var/task" \
    --workdir="/var/task" \
    --rm \
    --init \
    --privileged \
    --entrypoint "test/${1}" \
    "${2}"
fi
